{"ast":null,"code":"import { PLATFORM_ID } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/platform-browser\";\nimport * as i4 from \"@angular/cdk/clipboard\";\nimport * as i5 from \"@angular/material/snack-bar\";\nimport * as i6 from \"@angular/common\";\n\nfunction HomeComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3);\n    i0.ɵɵelement(2, \"img\", 4);\n    i0.ɵɵelementStart(3, \"div\", 5)(4, \"div\", 6);\n    i0.ɵɵelement(5, \"img\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"h5\", 8);\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"slice\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\", 9);\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"p\", 10);\n    i0.ɵɵtext(13);\n    i0.ɵɵpipe(14, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"a\", 11);\n    i0.ɵɵtext(16, \"QUERO ESSA OFERTA\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 12)(18, \"div\", 13)(19, \"a\", 14);\n    i0.ɵɵlistener(\"click\", function HomeComponent_div_1_Template_a_click_19_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r3);\n      const offer_r1 = restoredCtx.$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.copyLink(offer_r1.link);\n    });\n    i0.ɵɵelement(20, \"i\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"a\", 16);\n    i0.ɵɵelement(22, \"i\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"a\", 18);\n    i0.ɵɵelement(24, \"i\", 19);\n    i0.ɵɵelementEnd()()()()();\n  }\n\n  if (rf & 2) {\n    const offer_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"src\", offer_r1.thumbnail, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"src\", offer_r1.store.thumbnail, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", i0.ɵɵpipeBind3(8, 9, offer_r1.name, 0, 90), \"\", offer_r1.name.length > 90 ? \"...\" : \"\", \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 13, offer_r1.priceFrom, \"BRL\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(14, 16, offer_r1.price, \"BRL\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"href\", offer_r1.link, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"href\", ctx_r0.getSafeUrlWhatApp(offer_r1.link), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"href\", ctx_r0.getSafeUrlTelegram(offer_r1.link), i0.ɵɵsanitizeUrl);\n  }\n}\n\nexport let HomeComponent = /*#__PURE__*/(() => {\n  class HomeComponent {\n    constructor(http, activatedRoute, platformId, sanitizer, clipboard, snackBar) {\n      this.http = http;\n      this.activatedRoute = activatedRoute;\n      this.platformId = platformId;\n      this.sanitizer = sanitizer;\n      this.clipboard = clipboard;\n      this.snackBar = snackBar;\n      this.apiQA = 'http://sandbox-api.lomadee.com/v3/';\n      this.apiProd = 'https://api.lomadee.com/v3/';\n      this.appToken = '162644118076041fdcbc7';\n      this.sourceId = '23023468';\n      this.currentPage = 1;\n      this.pageSize = 26;\n      this.allDataLoaded = false;\n    }\n\n    ngOnInit() {\n      this.apiUrl = this.apiProd; //this.getCategories();\n      //this.getStores(); \n\n      this.activatedRoute.queryParams.subscribe(params => {\n        let categoryId = params['categoryId'];\n        let storeId = params['storeId'];\n        this.currentPage = 1;\n        this.resultOffers = null;\n        this.currentCategoryId = categoryId;\n        this.currentStoreId = storeId;\n\n        if (categoryId !== null && categoryId !== undefined || storeId !== null && storeId !== undefined) {\n          if (categoryId !== null) {\n            if (categoryId != undefined) this.getOffersByCategoryId(Number(categoryId), this.currentPage, this.pageSize);\n          }\n\n          if (storeId !== null) {\n            if (storeId != undefined) this.getOffersByStoreId(Number(storeId), this.currentPage, this.pageSize);\n          }\n        } else {\n          this.getBestSellerOffers(this.currentPage, this.pageSize);\n        }\n      });\n    }\n\n    getBestSellerOffers(page, size) {\n      if (this.currentCategoryId !== null) {\n        this.resultOffers = null;\n        page = 1;\n      }\n\n      this.http.get(this.apiUrl + this.appToken + '/offer/_bestsellers', {\n        params: {\n          sourceId: this.sourceId,\n          page: String(page),\n          size: String(size)\n        }\n      }).subscribe(data => {\n        if (this.resultOffers === null || this.resultOffers === undefined) {\n          this.resultOffers = data;\n          this.totalPages = data.pagination.totalPage;\n        } else {\n          this.resultOffers.offers = this.resultOffers.offers.concat(data.offers);\n          this.resultOffers.page = data.page;\n          this.resultOffers.pageSize = data.pageSize;\n          this.resultOffers.totalPages = data.totalPages;\n          this.resultOffers.totalRecords = data.totalRecords;\n          this.currentCategoryId = null;\n        }\n\n        console.log(this.resultOffers);\n      });\n    }\n\n    getCategories(page, size) {\n      this.http.get(this.apiUrl + this.appToken + '/category/_all', {\n        params: {\n          sourceId: this.sourceId,\n          hasOffer: 'true',\n          page: String(page),\n          size: String(size)\n        }\n      }).subscribe(data => {\n        this.categories = data;\n        console.log(this.categories);\n      });\n    }\n\n    getBestSellerCategories() {\n      this.http.get(this.apiUrl + this.appToken + '/category/_bestsellers', {\n        params: {\n          sourceId: this.sourceId,\n          hasOffer: 'true'\n        }\n      }).subscribe(data => {\n        this.categories = data;\n        console.log(this.categories);\n      });\n    }\n\n    getStores() {\n      this.http.get(this.apiUrl + this.appToken + '/store/_all', {\n        params: {\n          sourceId: this.sourceId,\n          hasOffer: 'true'\n        }\n      }).subscribe(data => {\n        this.stores = data;\n        console.log(this.stores);\n      });\n    }\n\n    getOffersByStoreId(storeId, page, size) {\n      if (this.currentStoreId !== storeId) {\n        this.resultOffers = null;\n        page = 1;\n      }\n\n      this.http.get(this.apiUrl + this.appToken + '/offer/_store/' + storeId, {\n        params: {\n          sourceId: this.sourceId,\n          page: String(page),\n          size: String(size),\n          sort: 'discount'\n        }\n      }).subscribe(data => {\n        if (data.offers.length === 0) {\n          this.allDataLoaded = true;\n        } else if (this.resultOffers === null) {\n          this.resultOffers = data;\n          this.resultOffers.offers = this.resultOffers.offers.filter((value, index, self) => {\n            // Retorna true se a posição do primeiro elemento igual ao atual for igual ao índice atual\n            return index === self.findIndex(o => o.thumbnail === value.thumbnail);\n          });\n          this.totalPages = data.pagination.totalPage;\n        } else {\n          this.resultOffers.offers = this.resultOffers.offers.concat(data.offers);\n          this.resultOffers.offers = this.resultOffers.offers.filter((value, index, self) => {\n            // Retorna true se a posição do primeiro elemento igual ao atual for igual ao índice atual\n            return index === self.findIndex(o => o.thumbnail === value.thumbnail);\n          });\n          this.resultOffers.page = data.page;\n          this.resultOffers.pageSize = data.pageSize;\n          this.resultOffers.totalPages = data.totalPages;\n          this.resultOffers.totalRecords = data.totalRecords;\n        }\n\n        this.currentStoreId = storeId;\n        console.log(this.resultOffers);\n      });\n    }\n\n    getOffersByCategoryId(categoryId, page, size) {\n      if (this.currentCategoryId !== categoryId) {\n        this.resultOffers = null;\n        page = 1;\n      }\n\n      this.http.get(this.apiUrl + this.appToken + '/offer/_category/' + categoryId, {\n        params: {\n          sourceId: this.sourceId,\n          page: String(page),\n          size: String(size),\n          sort: 'discount'\n        }\n      }).subscribe(data => {\n        if (data.offers.length === 0) {\n          this.allDataLoaded = true;\n        } else if (this.resultOffers === null) {\n          this.resultOffers = data;\n          this.resultOffers.offers = this.resultOffers.offers.filter((value, index, self) => {\n            // Retorna true se a posição do primeiro elemento igual ao atual for igual ao índice atual\n            return index === self.findIndex(o => o.thumbnail === value.thumbnail);\n          });\n          this.totalPages = data.pagination.totalPage;\n        } else {\n          this.resultOffers.offers = this.resultOffers.offers.concat(data.offers);\n          this.resultOffers.offers = this.resultOffers.offers.filter((value, index, self) => {\n            // Retorna true se a posição do primeiro elemento igual ao atual for igual ao índice atual\n            return index === self.findIndex(o => o.thumbnail === value.thumbnail);\n          });\n          this.resultOffers.page = data.page;\n          this.resultOffers.pageSize = data.pageSize;\n          this.resultOffers.totalPages = data.totalPages;\n          this.resultOffers.totalRecords = data.totalRecords;\n        }\n\n        this.currentCategoryId = categoryId;\n        console.log(this.resultOffers);\n      });\n    }\n\n    onScroll(event) {\n      if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {\n        this.loadMoreOffers();\n      }\n    }\n\n    loadMoreOffers() {\n      if (!this.allDataLoaded) {\n        if (this.currentPage < this.totalPages) {\n          this.currentPage++;\n\n          if (this.currentCategoryId !== null && this.currentCategoryId !== undefined || this.currentStoreId !== null && this.currentStoreId !== undefined) {\n            if (this.currentCategoryId !== null || this.currentCategoryId !== undefined) {\n              this.getOffersByCategoryId(this.currentCategoryId, this.currentPage, this.pageSize);\n            }\n\n            if (this.currentStoreId !== null || this.currentStoreId !== undefined) {\n              this.getOffersByStoreId(this.currentStoreId, this.currentPage, this.pageSize);\n            }\n          } else {\n            this.getBestSellerOffers(this.currentPage, this.pageSize);\n          }\n        }\n      }\n    }\n\n    copyLink(link) {\n      this.clipboard.copy(link);\n      this.snackBar.open('Link copiado!', 'Fechar', {\n        duration: 2000\n      });\n    }\n\n    getSafeUrlWhatApp(url) {\n      var completeUrl = 'whatsapp://send?text=' + url;\n      return this.sanitizer.bypassSecurityTrustResourceUrl(completeUrl);\n    }\n\n    getSafeUrlTelegram(url) {\n      var completeUrl = 'https://telegram.me/share/url?url=' + url;\n      return this.sanitizer.bypassSecurityTrustResourceUrl(completeUrl);\n    }\n\n  }\n\n  HomeComponent.ɵfac = function HomeComponent_Factory(t) {\n    return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(PLATFORM_ID), i0.ɵɵdirectiveInject(i3.DomSanitizer), i0.ɵɵdirectiveInject(i4.Clipboard), i0.ɵɵdirectiveInject(i5.MatSnackBar));\n  };\n\n  HomeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HomeComponent,\n    selectors: [[\"app-home\"]],\n    hostBindings: function HomeComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"scroll\", function HomeComponent_scroll_HostBindingHandler($event) {\n          return ctx.onScroll($event);\n        }, false, i0.ɵɵresolveWindow);\n      }\n    },\n    decls: 2,\n    vars: 1,\n    consts: [[1, \"row\", \"row-cols-1\", \"row-cols-md-3\", \"g-4\", \"products-catalog\"], [\"class\", \"col-xs-12 col-lg-3 product-card\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-xs-12\", \"col-lg-3\", \"product-card\"], [1, \"card\", \"h-100\"], [\"alt\", \"...\", 1, \"card-img-top\", 3, \"src\"], [1, \"card-body\"], [2, \"text-align\", \"center\"], [1, \"store-thumbnail\", 3, \"src\"], [1, \"card-title\"], [1, \"product-price-from\"], [1, \"card-text\", \"product-price\"], [1, \"btn\", \"btn-desconto\", 3, \"href\"], [1, \"card-footer\"], [1, \"share-buttons\"], [\"aria-hidden\", \"true\", 3, \"click\"], [1, \"fa\", \"fa-link\"], [\"data-action\", \"share/whatsapp/share\", 3, \"href\"], [\"aria-hidden\", \"true\", 1, \"fa\", \"fa-whatsapp\"], [3, \"href\"], [\"aria-hidden\", \"true\", 1, \"fa\", \"fa-telegram\"]],\n    template: function HomeComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, HomeComponent_div_1_Template, 25, 19, \"div\", 1);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.resultOffers == null ? null : ctx.resultOffers.offers);\n      }\n    },\n    directives: [i6.NgForOf],\n    pipes: [i6.SlicePipe, i6.CurrencyPipe],\n    styles: [\".card-title[_ngcontent-%COMP%]{height:80px}.product-card[_ngcontent-%COMP%]{margin-top:50px}.product-price[_ngcontent-%COMP%]{text-align:right;font-size:30px;font-weight:700;color:#e62020}.product-price-from[_ngcontent-%COMP%]{text-align:right;font-size:17px;color:#949494;text-decoration:line-through;font-weight:500}.card-body[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{width:100%;margin:0 auto;height:50px;line-height:2;font-weight:700}.store-thumbnail[_ngcontent-%COMP%]{width:80px;margin-bottom:10px}.card-img-top[_ngcontent-%COMP%]{height:220px!important}.btn-desconto[_ngcontent-%COMP%]{color:#fff;background-color:#e62020}.btn-desconto[_ngcontent-%COMP%]:hover{box-shadow:0 12px 16px #0000003d,0 17px 50px #00000030}.fa.fa-whatsapp[_ngcontent-%COMP%]{font-size:30px;color:#32cd32}.fa.fa-telegram[_ngcontent-%COMP%]{font-size:28px;margin-left:20px}.fa.fa-link[_ngcontent-%COMP%]{font-size:25px;margin-right:20px}.snack-bar[_ngcontent-%COMP%]{z-index:10}.share-buttons[_ngcontent-%COMP%]{text-align:center}@media (max-width: 767.98px){.products-catalog[_ngcontent-%COMP%]{margin-top:2rem}.card-img-top[_ngcontent-%COMP%]{height:330px!important}}\"]\n  });\n  return HomeComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}